" retlet .vimperatorrc
" for Vimperator 2.0pre (created: 2009/02/02 07:30:03)

" prefs
" ======================================================================
" タブの閉じるボタン非表示
set! browser.tabs.closeButtons=2

" セッションマネージャーの起動時設定
set! extensions.sessionmanager.old_startup_page=0
set! extensions.sessionmanager.startup=0
set! browser.startup.page=0

" ページのアクセスキーを無効化
set! ui.key.generalAccessKey=0

" Awesomebarの補完対象にBookmarkletを含める&件数を変更
set! browser.urlbar.filter.javascript=false
set! browser.urlbar.maxRichResults=10

" ポップアップ許可数を拡張 cf.http://la.ma.la/blog/diary_200611171115.htm
set! dom.popup_maximum=9999

" Gmail/LDR/Fastladder/OpenFLでは新規タブをバックグラウンドで開く
autocmd LocationChange (?!https?://(mail\.google\.com\/(mail|a)\/|(reader\.livedoor\.com|fastladder\.com|0\.0\.0\.0\:3000)/reader/|www\.google\.com\/reader\/)) :set! browser.tabs.loadDivertedInBackground=false
autocmd LocationChange https?://(mail\.google\.com\/(mail|a)\/|(reader\.livedoor\.com|fastladder\.com|0\.0\.0\.0\:3000)/reader/|www\.google\.com\/reader\/) :set! browser.tabs.loadDivertedInBackground=true

" options
" ======================================================================
" ex mode でインクリメント補完
set wildoptions=auto

" :[tab]open の補完対象と順番
set complete=sl

" ブラウザタイトルの変更
set titlestring=Firefox

" スクロールバーとタブ番号を表示
set go=rbn

" タブバーを常に表示
"set showtabline=2

" リンクのURIをコマンドラインに表示
set showstatuslinks=2

" 新規ウィンドウの処理
set popups=2

" ページロード時にテキストボックスにフォーカスするのを防ぐ
set focuscontent

" Beep設定
set visualbell
hi Bell opacity: .5;

noremap <C-1> :set guioptions=rbn<cr>
noremap <C-2> :set guioptions=rbnB<cr>
noremap <C-3> :set guioptions=rbnBmT<cr>

" mappings
" ======================================================================
" OSのキーバインドを再現 
map  <M-c> <C-v><M-c>
imap <C-f> <Right>
imap <C-b> <Left>
imap <C-p> <Up>
imap <C-n> <Down>
imap <M-a> <C-v><M-a>
imap <M-z> <C-v><M-z>
imap <M-x> <C-v><M-x>
imap <M-c> <C-v><M-c>
imap <M-v> <C-v><M-v>
cmap <C-f> <Right>
cmap <C-b> <Left>
cmap <C-p> <Up>
cmap <C-n> <Down>
cmap <M-a> <C-v><M-a>
cmap <M-z> <C-v><M-z>
cmap <M-x> <C-v><M-x>
cmap <M-c> <C-v><M-c>
cmap <M-v> <C-v><M-v>

" C-r でブラウザ再起動
map <C-r> :restart<CR>

" 上のディレクトリに移動
"map <BS> gu
map <C-BS> gU

" BSで戻る
map <BS> <A-Left>

" 読み込み停止
map ,s :stop<cr>

" j/k でのスクロール幅を1行から3行に変更
"noremap j 5j
"noremap k 5k

noremap <C-e> <C-v>j
noremap <C-y> <C-v>k

" J/K をC-d/u互換に
map J <C-d>
map K <C-u>

" タブ移動
map h <C-p>
map l <C-n>
map <C-k> <C-p>
map <C-j> <C-n>
map <Left>  <C-p>
map <Right> <C-n>

" タブ順序変更
"map <C-h> :tabmove! -1<CR>
"map <C-l> :tabmove! +1<CR>
map <S-Right> :tabmove! +1<CR>
map <S-Left>  :tabmove! -1<CR>

" buffer
map . :buffer<Space>


" URL中の数字を++/--
noremap ++ <C-a>
noremap -- <C-x>

" ! でページのCSSをon/off
map ! :set invum<CR>

" ex modeでC-jを無効化
cmap <C-j> <Nop>

" Delicious Bookmark Sidebar
map ,d :sidebar Delicious<cr>

" あとで読む
map ,l :open atode<CR>
map ,i :open instlet<CR>

" irvine hint mode
javascript <<EOM
hints.addMode( 'I', 'Download select element by irvine', 
  function (element){
    io.run('C:\\Documents and Settings\\joker\\My Documents\\toolz\\irvine1_3_0\\ircom.exe', ['-object', 'Irvine.Api', '-method', 'Download', element.href, 0]);
    hints.show("I");
  },
  function () '//a[@href]'
);
hints.addMode( 'i', 'Add select link element to irvine', 
  function (element){
    io.run('C:\\Documents and Settings\\joker\\My Documents\\toolz\\irvine1_3_0\\ircom.exe', ['-object', 'Irvine.Api', '-method', 'AddUrl', element.href, 0]);
    hints.show("i");
  }, 
  function () '//a[@href]'
);
hints.addMode( 'g', 'Add select image to irvine', 
  function (element){
    io.run('C:\\Documents and Settings\\joker\\My Documents\\toolz\\irvine1_3_0\\ircom.exe', ['-object', 'Irvine.Api', '-method', 'AddUrl', element.src, 0]);
    hints.show("g");
  }, 
  function () '//img[@src]'
);
EOM


" plugins
" ======================================================================
" delicious_search.js
"autocmd VimperatorEnter .* :set complete+=D

" ime_controller.js
let g:ex_ime_mode = "inactive"
let g:textarea_ime_mode = "inactive"

" encodingSwitcher.js
"map es :set fileencoding=Shift_JIS<CR>
"map ec :set fileencoding=EUC-JP<CR>

" migemo_hint.js
set hintmatching=custom

" nextlink.js
let g:nextlink_followlink = "true"
let g:nextlink_prevmap = "{{"
let g:nextlink_prevmap = "}}"

" sbmcommentsviewer.js
let g:def_sbm_format = "timestamp,id,tagsAndComment"
let g:def_sbms = "hd"
map ,c :viewSBMComments<CR>

" direct_bookmark.js
let g:direct_sbm_use_services_by_tag = "d"
let g:direct_sbm_use_services_by_post = "d"
let g:direct_sbm_is_normalize = "false"
let g:direct_sbm_is_use_migemo = "true"
map B :bentry<CR>
"map A :sbm<CR>
map a :sbm<Space>
map ,a :btags<CR>

" ldrize_cooperation.js
let g:ldrc_captureMappings = "['j','k','p','o','?']"
let g:ldrc_hints = "true"
let g:ldrc_intelligence_bind = "true"
let g:ldrc_skip = "0.4"
map Q :toggleldrc<CR>

" multi_requester.js
map ,t :twitter<Space>
map ,T :twitter!<Space>
map ,@ :twitter!@<CR>
map ,m :mixiecho<Space>
map ,w :twissr<Space>
map ,rt :mr<Space>twitter-search-pcod-no-jp<Space>
map ,rT :mr<Space>twitter-search-pcod-no-jp<Space>["joker1007"]<CR>
map ,rf :mr<Space>favotter-new<Space>
map ,rF :mr<Space>favotter-new<Space>["joker1007"]<CR>

" copy.js
map cs :copy<Space>
map cc <esc>:copy<cr>
map cu <esc>:copy %URL%<cr>
map ct <esc>:copy %TITLE%<cr>
map cb <esc>:copy %TITLE% - %URL%<cr>
js <<EOM
liberator.globalVariables.copy_templates = [
  { label: 'titleAndURL',    value: '%TITLE% %URL%' },
  { label: 'title',          value: '%TITLE%' },
  { label: 'url',            value: '%URL%' },
  { label: 'markdown',       value: '[%TITLE%](%URL% "%TITLE%")' },
  { label: 'markdownsel',    value: '[%SEL%](%URL% "%TITLE%")' },
  { label: 'htmlblockquote', value: '<blockquote cite="%URL%" title="%TITLE%">%HTMLSEL%</blockquote>' }
];
EOM

" autoproxychanger.js
js <<EOM
liberator.globalVariables.autochanger_proxy_enabled = true;
liberator.globalVariables.autochanger_proxy_settings = [{
  name  : 'disable',
  usage : 'direct connection',
  proxy :{
	type      :0,
  },
},{
  name  : 'polipo-auto',
  usage : 'polipo pac file',
  proxy :{
	autoconfig_url : 'file:///C:/polipo/otsune-proxy.pac',
	type           : 2,
  },
}];
EOM

" localkeymode.js
let g:localkeymode_enable = "true"
js <<EOM
liberator.globalVariables.localKeyMappings=[
    [/www\.nicovideo\.jp\/watch/, [
        ['p', ':nicopause'],
        ['m', ':nicomute'],
        ['v', ':nicommentvisible'],
        ['s', ':nicoseek! +10'],
        ['S', ':nicoseek! -10'],
        ['z', ':nicosize'],
        ['c', ':nicomment ', true],
        ['C', ':nicommand ', true],
    ]],
];
EOM

" feedSomeKeys_2.js
autocmd LocationChange .* :fmapc
" Tumblr (要dashboard+tombloo.user.js, ReblogCommand.user.js)
autocmd LocationChange http://.*\.tumblr\.com/ :fmap r,tj
autocmd LocationChange http://.*\.tumblr\.com/ :fmap j k p
" favotter (要Twit Fav command Minibuffer)
autocmd LocationChange http://favotter\.matope\.com/ :fmap f,F
" Gmail
autocmd LocationChange mail\.google\.com/(mail|a)/ :fmap -d 4 c / j k n p o u e x s r a # [ ] z ? gi gs gt gd ga gc
" GoogleReader
autocmd LocationChange www\.google\.com/reader/ :fmap! -vkey j k n p m s v o A r S N P X O gh ga gs gt gu u / ? J,<Space> K,<S-Space>
autocmd LocationChange www\.google\.co\.jp/reader/ :fmap! -vkey j k n p m s v o A r S N P X O gh ga gs gt gu u / ? J,<Space> K,<S-Space>
" LDR/Fastladder/OpenFL
autocmd LocationChange http://(reader\.livedoor\.com|fastladder\.com|0\.0\.0\.0\:3000)/reader/ :fmap j k s a p v c z Z b i r < > o,vj J,<Space> K,<S-Space> q w g u 
" Fastladder Reblog用 (要tombloo.xpi/ldr+tombloo.user.js)
autocmd LocationChange http://fastladder\.com/reader/ :fmap i,Tj
autocmd LocationChange http://fastladder\.com/reader/ :fmap e,Tj

" javascripts
" ======================================================================
" ステータスバーにfeedボタンを表示
js <<EOM
(function(){
 var feedPanel = document.createElement('statusbarpanel');
 var feedButton = document.getElementById('feed-button');
 feedPanel.setAttribute('id','feed-panel-clone');
 feedPanel.appendChild(feedButton.cloneNode(true));
 feedButton.parentNode.removeChild(feedButton);
 document.getElementById('status-bar').insertBefore(feedPanel,document.getElementById('security-button'));
})();
EOM

" feedSomeKeys_2.jsとlocalkeymode.jsの相性問題対応パッチ
" cf.http://vimperator.g.hatena.ne.jp/nokturnalmortum/20081220/1229773089
"js <<EOM
"autocommands.add(
"  'VimperatorEnter',
"  /.*/,
"  function () {
"    let (orig = plugins.LocalKeyMode.loadKeyMap) {
"      plugins.LocalKeyMode.loadKeyMap = function () {
"        if (!liberator.plugins.feedKey || liberator.plugins.feedKey.origMap.length <= 0)
"          orig.call(plugins.LocalKeyMode);
"      };
"    }
"  }
");
"EOM

" qmarks
" ======================================================================
qmark g https://mail.google.com/
qmark c https://www.google.com/calendar/

" colorscheeme
" ======================================================================
colorscheme sweets

" vim: set ft=vimperator:
